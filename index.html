<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TonRewardy Ultra v11</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getDatabase, ref, set, get, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCHoJOxu9VbhBZJApcr1lwdbAftipLLRe8",
        authDomain: "tonrewardy.firebaseapp.com",
        projectId: "tonrewardy",
        storageBucket: "tonrewardy.firebasestorage.app",
        messagingSenderId: "574214688145",
        appId: "1:574214688145:web:7681f67cd3005258a29e30"
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      window.db = db;
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;600&display=swap');
        body { font-family: 'SF Pro Display', sans-serif; background: #000; color: #fff; height: 100vh; width: 100vw; overflow: hidden; user-select: none; -webkit-tap-highlight-color: transparent; font-size: 11px; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 16px; }
        .tab-pane { display: none; height: calc(100vh - 210px); flex-direction: column; animation: slideUp 0.2s ease; overflow-y: auto; padding-bottom: 80px; }
        .tab-pane.active { display: flex; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .nav-btn { opacity: 0.3; transition: 0.2s; font-size: 18px; }
        .nav-active { opacity: 1; transform: scale(1.1); filter: drop-shadow(0 0 5px #fff); }
        .scroll-list { max-height: 100px; overflow-y: auto; scrollbar-width: none; border-radius: 12px; }
        .xp-bar { height: 4px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; }
        .xp-fill { height: 100%; background: linear-gradient(90deg, #0088cc, #00fbff); width: 0%; transition: 0.5s ease; }
        #shield-lock, #admin-modal { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; padding: 20px; }
        header { position: sticky; top: 0; z-index: 40; background: black; padding-bottom: 10px; }
    </style>
</head>
<body class="p-3">

    <div id="shield-lock" class="items-center justify-center text-center">
        <i class="fa-solid fa-shield-halved text-4xl mb-4 text-blue-500"></i>
        <h1 class="text-lg font-bold uppercase">System Secure</h1>
    </div>

    <div id="admin-modal" class="overflow-y-auto">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-xl font-bold text-blue-400">ADMIN PANEL</h1>
            <button onclick="document.getElementById('admin-modal').style.display='none'"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        <div class="glass p-3 mb-4">
            <p class="text-xs text-blue-400 font-bold mb-2">SYSTEM TOOLS</p>
            <button onclick="resetStats()" class="w-full bg-red-500/20 text-red-500 py-2 rounded-lg text-[9px] font-bold uppercase border border-red-500/30">Reset All Stats</button>
        </div>
        <div id="adm-withdraw-list" class="space-y-2"></div>
    </div>

    <header>
        <div class="flex justify-between items-end mb-3">
            <div class="flex items-center gap-2">
                <img src="https://cryptologos.cc/logos/toncoin-ton-logo.png" class="w-6 h-6">
                <div>
                    <p id="ton-price-live" class="text-[11px] font-bold text-blue-400 leading-none">Fetching...</p>
                    <p class="text-[7px] text-gray-500 uppercase tracking-tighter" id="t-market">Live Market</p>
                </div>
            </div>
            <div class="text-right">
                <p id="main-bal" class="text-2xl font-black tracking-tighter leading-none text-white">0.0000</p>
                <p class="text-[8px] text-gray-500 uppercase font-bold" id="t-baldesc">Balance</p>
            </div>
        </div>

        <div class="glass p-2.5 mb-3">
            <div class="flex justify-between items-center mb-1.5">
                <span class="text-[10px] font-bold text-blue-400 uppercase">Level <span id="lvl-txt">1</span></span>
                <span class="text-[8px] font-medium text-gray-400"><span id="xp-txt">0</span> / 100 XP</span>
            </div>
            <div class="xp-bar"><div id="xp-fill" class="xp-fill"></div></div>
        </div>

        <div class="grid grid-cols-4 gap-1.5 text-center">
            <div class="glass p-1.5 py-2"><p class="text-[6px] text-gray-500 uppercase mb-0.5" id="t-daily">Daily</p><p class="text-[9px] font-bold text-blue-400" id="stat-d">0.0000</p></div>
            <div class="glass p-1.5 py-2"><p class="text-[6px] text-gray-500 uppercase mb-0.5" id="t-weekly">Weekly</p><p class="text-[9px] font-bold text-blue-400" id="stat-w">0.0000</p></div>
            <div class="glass p-1.5 py-2"><p class="text-[6px] text-gray-500 uppercase mb-0.5" id="t-monthly">Monthly</p><p class="text-[9px] font-bold text-blue-400" id="stat-m">0.0000</p></div>
            <div class="glass p-1.5 py-2"><p class="text-[6px] text-gray-500 uppercase mb-0.5" id="t-yearly">Yearly</p><p class="text-[9px] font-bold text-blue-400" id="stat-y">0.0000</p></div>
        </div>
    </header>

    <main class="flex-grow pt-2">
        <section id="tab-watch" class="tab-pane active space-y-3">
            <div class="glass flex-grow flex flex-col items-center justify-center p-6 text-center border-white/5">
                <div class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mb-4 border border-blue-500/20 shadow-2xl shadow-blue-500/20">
                    <i class="fa-solid fa-play text-blue-400 text-lg"></i>
                </div>
                <h2 id="t-ready" class="text-sm font-bold uppercase tracking-widest text-white">Ready to Earn</h2>
                <p id="t-claim" class="text-gray-500 text-[9px] mt-1.5">Daily Progress: <span id="ads-count" class="text-blue-400 font-bold">0</span> / 2500</p>
                <button onclick="watchAd()" class="w-full bg-white text-black py-3.5 rounded-2xl font-black mt-6 active:scale-95 text-[11px] uppercase transition-transform shadow-lg">Launch Advertise</button>
            </div>
        </section>

        <section id="tab-ref" class="tab-pane space-y-2">
            <div class="grid grid-cols-2 gap-2">
                <div class="glass p-3"><p class="text-[7px] text-gray-500 uppercase" id="t-invited">Invited</p><p id="ref-count" class="text-lg font-bold">0</p></div>
                <div class="glass p-3"><p class="text-[7px] text-gray-500 uppercase" id="t-refearn">Profit</p><p class="text-lg font-bold text-green-400">0.00</p></div>
            </div>
            <div class="glass p-3 flex-grow min-h-0">
                <p class="text-[8px] text-gray-500 uppercase mb-2" id="t-refhist">History</p>
                <div id="ref-list" class="scroll-list space-y-1 text-[9px]">
                    <p class="opacity-30 italic p-2 text-center">Invite friends to see list.</p>
                </div>
                <div class="flex gap-2 mt-4">
                    <button onclick="copyLink()" class="flex-1 bg-white/5 py-2.5 rounded-xl text-[9px] font-bold uppercase border border-white/10" id="t-copy">Copy</button>
                    <button onclick="shareLink()" class="flex-1 bg-white text-black py-2.5 rounded-xl text-[9px] font-bold uppercase" id="t-share">Share</button>
                </div>
            </div>
        </section>

        <section id="tab-wallet" class="tab-pane space-y-3">
            <div class="glass p-3 space-y-2.5">
                <p class="text-[8px] text-gray-500 uppercase" id="t-bindtitle">Bind TON Wallet</p>
                <input id="wallet-addr" type="text" placeholder="UQ... Address" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-[10px] outline-none text-white focus:border-blue-500">
                <input id="wallet-memo" type="text" placeholder="Memo (Optional)" class="w-full bg-white/5 border border-white/10 rounded-xl p-3 text-[10px] outline-none text-white focus:border-blue-500">
                <button onclick="saveWallet()" class="w-full bg-blue-600 text-white py-3 rounded-xl text-[10px] font-bold uppercase" id="t-save">Save Settings</button>
            </div>
            <div id="withdraw-list" class="space-y-2"></div>
        </section>

        <section id="tab-profile" class="tab-pane space-y-2">
            <p class="text-[8px] text-gray-500 uppercase px-1" id="t-langtitle">Language</p>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="setLang('tr')" class="glass p-3 flex items-center gap-2 text-[10px]"><img src="https://flagcdn.com/w40/tr.png" class="w-4 h-4 rounded-full object-cover"> Türkçe</button>
                <button onclick="setLang('en')" class="glass p-3 flex items-center gap-2 text-[10px]"><img src="https://flagcdn.com/w40/us.png" class="w-4 h-4 rounded-full object-cover"> English</button>
            </div>
            <button id="admin-btn" onclick="document.getElementById('admin-modal').style.display='flex'" class="hidden w-full glass p-3 border-blue-500/40 text-blue-400 font-bold text-[10px] uppercase mt-2">
                <i class="fa-solid fa-crown mr-2"></i> Admin Panel
            </button>
        </section>
    </main>

    <nav class="fixed bottom-6 left-6 right-6 h-16 glass bg-black/80 flex justify-around items-center px-4 z-50 rounded-2xl border-white/10 shadow-2xl">
        <button onclick="switchT('watch')" class="nav-btn nav-active"><i class="fa-solid fa-play"></i></button>
        <button onclick="switchT('ref')" class="nav-btn"><i class="fa-solid fa-user-group"></i></button>
        <button onclick="switchT('wallet')" class="nav-btn"><i class="fa-solid fa-wallet"></i></button>
        <button onclick="switchT('profile')" class="nav-btn"><i class="fa-solid fa-sliders"></i></button>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        let state = {
            bal: 0.0000,
            earnedDaily: 0.0000,
            earnedWeekly: 0.0000,
            earnedMonthly: 0.0000,
            earnedYearly: 0.0000,
            ref: 0,
            adsToday: 0,
            lvl: 1,
            xp: 0,
            lang: "en",
            userId: tg.initDataUnsafe?.user?.id || "7904032877",
            adminId: "7904032877"
        };

        const translations = {
            en: { daily: "Daily", weekly: "Weekly", monthly: "Monthly", yearly: "Yearly", ready: "Ready to Earn", invited: "Invited", refearn: "Profit", refhist: "History", bindtitle: "Bind TON Wallet", save: "Save Settings", market: "Live Market", baldesc: "Balance", copy: "Copy", share: "Share", langtitle: "Language" },
            tr: { daily: "Günlük", weekly: "Haftalık", monthly: "Aylık", yearly: "Yıllık", ready: "Kazanmaya Hazır", invited: "Davet Edilen", refearn: "Kazanç", refhist: "Geçmiş", bindtitle: "TON Cüzdanını Bağla", save: "Ayarları Kaydet", market: "Piyasa", baldesc: "Bakiye", copy: "Kopyala", share: "Paylaş", langtitle: "Dil Seçimi" }
        };

        async function fetchTonPrice() {
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=the-open-network&vs_currencies=usd');
                const data = await res.json();
                document.getElementById('ton-price-live').innerText = `$${data['the-open-network'].usd.toFixed(2)}`;
            } catch (e) { document.getElementById('ton-price-live').innerText = "$5.45"; }
        }

        function watchAd() {
            if(state.adsToday >= 2500) return tg.showAlert("Daily limit reached!");
            
            const reward = 0.0005;
            state.bal += reward;
            state.adsToday += 1;
            state.xp += 10;

            // KAZANÇ İSTATİSTİKLERİNİ DOĞRU ARTTIRMA
            state.earnedDaily += reward;
            state.earnedWeekly += reward;
            state.earnedMonthly += reward;
            state.earnedYearly += reward;

            if(state.xp >= 100 && state.lvl < 100) {
                state.xp = 0;
                state.lvl += 1;
                tg.HapticFeedback.notificationOccurred('success');
            }

            updateUI();
            tg.HapticFeedback.impactOccurred('medium');
        }

        function updateUI() {
            document.getElementById('main-bal').innerText = state.bal.toFixed(4);
            
            // Gerçek Kazanç Verileri
            document.getElementById('stat-d').innerText = state.earnedDaily.toFixed(4);
            document.getElementById('stat-w').innerText = state.earnedWeekly.toFixed(4);
            document.getElementById('stat-m').innerText = state.earnedMonthly.toFixed(4);
            document.getElementById('stat-y').innerText = state.earnedYearly.toFixed(4);
            
            document.getElementById('lvl-txt').innerText = state.lvl;
            document.getElementById('xp-txt').innerText = state.xp;
            document.getElementById('xp-fill').style.width = state.xp + "%";
            document.getElementById('ads-count').innerText = state.adsToday;

            renderWithdraws();
        }

        function resetStats() {
            state.earnedDaily = 0;
            state.earnedWeekly = 0;
            state.earnedMonthly = 0;
            state.earnedYearly = 0;
            state.adsToday = 0;
            updateUI();
            tg.showAlert("All earnings stats have been reset.");
        }

        function setLang(c) {
            state.lang = c;
            const t = translations[c] || translations.en;
            Object.keys(t).forEach(k => { if(document.getElementById('t-'+k)) document.getElementById('t-'+k).innerText = t[k]; });
            renderWithdraws();
        }

        function renderWithdraws() {
            const container = document.getElementById('withdraw-list');
            const opts = [{a:0.01, r:1}, {a:0.05, r:5}, {a:0.1, r:10}];
            container.innerHTML = opts.map(o => {
                const can = state.bal >= o.a && state.ref >= o.r;
                return `<div class="glass p-4 flex justify-between items-center border-l-2 ${can ? 'border-green-500' : 'border-red-500/50'}">
                    <div><p class="text-[11px] font-bold text-white">${o.a} TON</p><p class="text-[8px] text-gray-500 uppercase">${o.r} Ref Required</p></div>
                    <button class="${can ? 'bg-blue-500 text-white' : 'bg-white/5 text-gray-500'} px-4 py-2 rounded-xl text-[9px] font-black uppercase">Claim</button>
                </div>`;
            }).join('');
        }

        function switchT(id) {
            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active'));
            document.getElementById('tab-' + id).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active'));
            event.currentTarget.classList.add('nav-active');
            tg.HapticFeedback.impactOccurred('light');
        }

        if(state.userId.toString() === state.adminId) document.getElementById('admin-btn').classList.remove('hidden');

        fetchTonPrice();
        setInterval(fetchTonPrice, 60000);
        updateUI();
        setLang('en');
    </script>
</body>
</html>
